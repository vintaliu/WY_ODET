C51 COMPILER V9.52.0.0   SYSTEMINIT                                                        07/13/2021 15:24:48 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE SYSTEMINIT
OBJECT MODULE PLACED IN ..\OBJ\SystemInit.obj
COMPILER INVOKED BY: D:\Program Files (x86)\KeilC51-V952\C51\BIN\C51.EXE ..\Code\SystemInit.c OMF2 BROWSE INCDIR(..\Incl
                    -ude) DEBUG PRINT(..\Listings\SystemInit.lst) TABS(2) OBJECT(..\OBJ\SystemInit.obj)

line level    source

   1          #include "User_Def.h"
   2          #include "intrins.h"
   3          #include "stdio.h"
   4          #include "SystemInit.h"
   5          #include "function.h"
   6          void vInitAdc(void)
   7          {
   8   1          ADCCR0 = 0;
   9   1          ADCCR1 = 0;
  10   1          ADRIOS0 = 0;
  11   1          ADRIOS1 = 0; //寄存器清0
  12   1        
  13   1          ADCCR0 = 0x6C;     //  选择通道6  参考电压为VCC 不使能ADC
  14   1          ADCCR1 = 0x81;     //  一个采样时钟  ADC时钟为Fsys 采样结果高4位低八位
  15   1          ADRIOS0 = 0x40;    //  使能通道6
  16   1          ADRIOS1 = 0x00;
  17   1          ADCCR0 = 0x6D;     //使能ADC
  18   1        
  19   1        
  20   1      }
  21          void vSysSourceInit(void)
  22          {
  23   1          clr_EA;      //关闭中断
  24   1          GPIO_Init();
  25   1          Time0_Init();    
  26   1          PWM1_Init();
  27   1          vInitAdc();
  28   1          Uart_Init();
  29   1          set_EA;      //打开中断
  30   1      //  while(1)
  31   1      //  {
  32   1      //    g_us1msTimes = 200;
  33   1      //    while(g_us1msTimes);
  34   1      //  vSendFeedBack();    
  35   1      //  }
  36   1      
  37   1      }
  38          
  39          void GPIO_Init(void)
  40          {
  41   1      
  42   1          P0MOD0=0x05;   //P00 P01推挽输出
  43   1          P1MOD0=0x95;   //P10 P11 P12  推挽输出   P13  输入
  44   1          P1MOD1=0x25;   //P14 P15(串口TX) 推挽输出  P16(串口RX) 输入
  45   1          P2MOD0=0xA4;   //P21 P24  推挽输出  P22  P23 输入
  46   1          P2MOD1=0x55;    //P24 P25 P26 P27  推挽输出
  47   1        
  48   1          P15D=1;     //串口TX输出高  初始化串口TX必须置高 否则数据发送会异常WH
  49   1          POWER_SHOW_0;
  50   1          SPEED_LED_0;
  51   1      
  52   1      }
  53          
  54          void PWM1_Init(void)
C51 COMPILER V9.52.0.0   SYSTEMINIT                                                        07/13/2021 15:24:48 PAGE 2   

  55          {
  56   1        SLK_SFR1();         //切换SFR1
  57   1        PWM1CR0 = 0x80;     //使能PWM1模块
  58   1        //在PWM1 输出中,请勿随意修改频率,否则会影响 PWM1 的输出结果;
  59   1        //建议按为先关闭PWM1,修改后再打开PWM1的顺序操作
  60   1        PWM1CR1 = 0x23;                                         //PWM1CLK=8分频 
  61   1        PWM1CR0 = 0x88;                                         //使能通道13
  62   1        PWM1PH = 1000 >> 8;
  63   1        PWM1PL = 1000 % 256;                                      //周期
  64   1        PWM1CR2 = 0x80;
  65   1        PWM13DH = 0 >> 8;
  66   1        PWM13DL = 0 % 256;                                        //占空比0%
  67   1        PWM1CR3 = 0x88;                                           //使能比较功能
  68   1      
  69   1        SLK_SFR0(); 
  70   1      }
  71          #define Uart1BaudRate       9440
  72          void Uart_Init(void)    //T1M = 1, SMOD = 1    UART0_Timer1
  73          {
  74   1        PCON |= DEF_SET_BIT7; //使能UART1
  75   1        SCON_1 &= 0x3f;
  76   1        SCON_1 |= 0x50; //方式1  允许接收
  77   1      
  78   1        TMOD &= 0xCF;
  79   1        TMOD |= DEF_SET_BIT5; //内部时钟  方式2
  80   1        TR1 = 0;
  81   1        TL1 = (256 - 16000000 / 16 / Uart1BaudRate);
  82   1        TH1 = (256 - 16000000 / 16 / Uart1BaudRate);
  83   1        TR1 = 1; //打开T1
  84   1      
  85   1        IE1 |= DEF_SET_BIT3; //打开UART1中断
  86   1        
  87   1      }
  88          
  89          void Time0_Init(void)
  90          {
  91   1        TMOD = 0x01;    //内部时钟  方式1
  92   1        TCON = 0x00;
  93   1        TCON1 = 0x03; //FT0=FSYS/16 禁止溢出IO翻转
  94   1        TR0 = 0;    //无论是读或者写 TLx/THx 的值，必须先停止(TR0=0;)
  95   1        TL0 = 0x18;   //  1ms
  96   1        TH0 = 0xFC;   //读写时，先读写L，在H
  97   1      
  98   1        IP = 0x02;
  99   1        IPH = 0x00; //中断等级1(高)
 100   1        T0IE = 1;
 101   1        TR0 = 1;
 102   1      }//启用TIM0定时器中断
 103          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    169    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
C51 COMPILER V9.52.0.0   SYSTEMINIT                                                        07/13/2021 15:24:48 PAGE 3   

   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
